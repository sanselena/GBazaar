<!--AŞK buraya öyle bir metod lazım ki hangi ürünün id'si ile bu sayfa açılmışsa o ürünün detayları  gözüksün nasıl olacağına pek kafam basmıyor şu an-->
@model GBazaar.Models.Product

@{
    var usingSampleProduct = ViewBag.UsingSampleProduct is bool sample && sample;
    var priceDisplay = Model.UnitPrice.HasValue
        ? Model.UnitPrice.Value.ToString("C")
        : "Pricing on request";
    var unitSuffix = string.IsNullOrWhiteSpace(Model.UnitOfMeasure)
        ? string.Empty
        : $" / {Model.UnitOfMeasure}";
    var supplierName = Model.Supplier?.SupplierName ?? "Unknown Supplier";
    var supplierInitial = string.IsNullOrWhiteSpace(supplierName)
        ? "?"
        : supplierName.Trim()[0].ToString().ToUpperInvariant();
}

<div class="container mt-5 mb-5">
    <div class="row g-5">
        <div class="col-md-6">
            <div class="main-image-container">
                <div class="arrow arrow-left"><i class="fas fa-chevron-left"></i></div>
                <img src="/images/products/@(Model.ProductID).png" 
                     class="main-img" 
                     alt="@Model.ProductName main image"
                     style="width: 100%; height: 400px; object-fit: cover; border-radius: 10px;"
                     onerror="tryNextImageExtension(this, @Model.ProductID, '@Uri.EscapeDataString(Model.ProductName)', 'main')">
                <div class="arrow arrow-right"><i class="fas fa-chevron-right"></i></div>
            </div>

            <div class="thumbnail-strip mt-3">
                <img src="/images/products/@(Model.ProductID).png" 
                     class="thumb active" 
                     alt="Product thumbnail 1"
                     style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px;"
                     onerror="tryNextImageExtension(this, @Model.ProductID, '@Uri.EscapeDataString(Model.ProductName)', 'thumb1')">
                <img src="/images/products/@(Model.ProductID).png" 
                     class="thumb" 
                     alt="Product thumbnail 2"
                     style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px;"
                     onerror="tryNextImageExtension(this, @Model.ProductID, '@Uri.EscapeDataString(Model.ProductName)', 'thumb2')">
                <img src="/images/products/@(Model.ProductID).png" 
                     class="thumb" 
                     alt="Product thumbnail 3"
                     style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px;"
                     onerror="tryNextImageExtension(this, @Model.ProductID, '@Uri.EscapeDataString(Model.ProductName)', 'thumb3')">
            </div>
        </div>

        <div class="col-md-6 product-details-col">
            @* === BİLDİRİM ALANI EKLENDİ === *@
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">@TempData["Error"]</div>
            }

            @if (usingSampleProduct)
            {
                <div class="alert alert-info mb-3" role="alert">
                    Showing a placeholder listing because the live product catalog is currently unreachable.
                </div>
            }

            <span class="badge bg-secondary mb-2">Wholesale / Bulk</span>
            <h1 class="product-title">@Model.ProductName</h1>

            <div class="supplier-card mb-3 p-2 border rounded d-flex align-items-center gap-3" style="background-color: white;">
                <div class="avatar-circle" style="background-color: var(--primary);">@supplierInitial</div>
                <div>
                    <div style="font-weight: bold; font-size: 0.9rem;">@supplierName</div>
                    <div style="font-size: 0.8rem; color: #666;">Member since 2021 • Success Rate: 94%</div>
                </div>
            </div>

            <div class="rating-section mb-3">
                <span class="stars">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                </span>
                <span class="review-count">(Based on 42 fulfilled orders)</span>
            </div>

            <div class="price-info mb-4">
                <span class="text-muted">Supplier Asking Price:</span>
                <div class="price-tag" style="font-size: 1.5rem;">@priceDisplay<span style="font-size: 1rem; color: #666;">@unitSuffix</span></div>
                <div style="font-size: 0.9rem; color: #28a745;"><i class="fas fa-check-circle"></i> 50,000 kg Available Now</div>
            </div>

            <div class="offer-card p-4" style="background-color: #f8f9fa; border: 2px solid var(--border-pop); border-radius: 15px;">
                <h4 class="mb-3" style="color: var(--text-main); font-weight: 700;">Create Purchase Request</h4>

                <form asp-action="CreatePurchaseRequest" asp-controller="Product" method="post">
                    <!-- Gizli alanlar ile ürün bilgilerini gönder -->
                    <input type="hidden" name="ProductId" value="@Model.ProductID" />
                    <input type="hidden" name="ProductName" value="@Model.ProductName" />
                    <input type="hidden" name="ProductDescription" value="@Model.Description" />
                    <input type="hidden" name="UnitOfMeasure" value="@Model.UnitOfMeasure" />

                    <div class="mb-3">
                        <label class="form-label" style="font-weight: 600;">Quantity Required (@Model.UnitOfMeasure)</label>
                        <input type="number" name="Quantity" class="form-control custom-input" placeholder="e.g. 10000" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" style="font-weight: 600;">Your Offer per Unit ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" name="UnitPrice" class="form-control" placeholder="e.g. @Model.UnitPrice?.ToString("0.00")" step="0.01" required>
                        </div>
                        <small class="text-muted">Supplier is asking for @Model.UnitPrice?.ToString("C").</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" style="font-weight: 600;">Note to Supplier</label>
                        <textarea name="Justification" class="form-control" rows="2" style="border-radius: 15px; border: 1px solid #ccc;" placeholder="Need delivery by next Friday..."></textarea>
                    </div>

                    <button type="submit" class="btn w-100" style="background-color: var(--text-main); color: white; border-radius: 50px; padding: 12px; font-weight: bold;">
                        Submit Purchase Request
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function tryNextImageExtension(img, productId, productName, imageType) {
    // Try different extensions in order
    const extensions = ['jpg', 'jpeg', 'gif'];
    const currentSrc = img.src;

    // Find which extension we're currently trying
    let currentExtension = '';
    if (currentSrc.includes('.png')) currentExtension = 'png';
    else if (currentSrc.includes('.jpg')) currentExtension = 'jpg';
    else if (currentSrc.includes('.jpeg')) currentExtension = 'jpeg';
    else if (currentSrc.includes('.gif')) currentExtension = 'gif';

    // Find next extension to try
    let nextExtension = '';
    if (currentExtension === 'png') nextExtension = 'jpg';
    else if (currentExtension === 'jpg') nextExtension = 'jpeg';
    else if (currentExtension === 'jpeg') nextExtension = 'gif';

    if (nextExtension) {
        img.onerror = function() { tryNextImageExtension(this, productId, productName, imageType); };
        img.src = `/images/products/${productId}.${nextExtension}`;
    } else {
        // No more extensions to try, use placeholder based on image type
        img.onerror = null;
        if (imageType === 'main') {
            img.src = `https://via.placeholder.com/600x400/C4C1ED/6E6DCC?text=${encodeURIComponent(productName)}`;
        } else {
            // For thumbnails
            const thumbNumber = imageType.replace('thumb', '');
            img.src = `https://via.placeholder.com/100x100/C4C1ED/6E6DCC?text=${thumbNumber}`;
        }
    }
}

// Thumbnail click functionality
document.addEventListener('DOMContentLoaded', function() {
    const mainImg = document.querySelector('.main-img');
    const thumbnails = document.querySelectorAll('.thumb');
    
    thumbnails.forEach(function(thumb, index) {
        thumb.addEventListener('click', function() {
            // Remove active class from all thumbnails
            thumbnails.forEach(t => t.classList.remove('active'));
            // Add active class to clicked thumbnail
            this.classList.add('active');
            
            // Update main image (for now just copy the thumbnail source)
            // In a real scenario, you might have different high-res versions
            mainImg.src = this.src;
        });
    });
});
</script>

